<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HaRiÃ© CMS â€“ Debug Mode</title>

    <style>
      body {
        font-family: monospace;
        padding: 1.5rem;
        background: #0d1117;
        color: #c9d1d9;
      }
      h3 {
        color: #58a6ff;
      }
      #log {
        white-space: pre-wrap;
        background: #161b22;
        color: #00ff80;
        padding: 1rem;
        border-radius: 8px;
        overflow-y: auto;
        max-height: 40vh;
        border: 1px solid #30363d;
        margin-bottom: 1rem;
      }
      .error {
        color: #ff5555;
      }
      .warn {
        color: #ffaa00;
      }
      .success {
        color: #00ff80;
      }
      #cms-root {
        background: #fff;
        color: #000;
        height: 70vh;
        border-radius: 6px;
        overflow: hidden;
      }
    </style>

    <!-- Libraries -->
    <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://unpkg.com/netlify-cms-app@^3.0.0/dist/netlify-cms.js"></script>

    <script>
      window.CMS_MANUAL_INIT = true;

      const logBox = () => document.getElementById("log");
      const log = (msg, type = "info") => {
        const entry = document.createElement("div");
        entry.className = type;
        entry.textContent = msg;
        logBox().appendChild(entry);
        console[type === "error" ? "error" : type === "warn" ? "warn" : "log"](
          msg
        );
      };

      window.addEventListener("load", async () => {
        log("ğŸ“˜ CMS page loaded, starting extended debug...");

        // Verify global CMS objects
        log(`ğŸ“¦ window.NetlifyCmsApp: ${!!window.NetlifyCmsApp}`);
        log(`ğŸ“¦ window.CMS: ${!!window.CMS}`);
        log(`ğŸ“¦ window.netlifyCms: ${!!window.netlifyCms}`);

        const cms = window.NetlifyCmsApp || window.CMS || window.netlifyCms;
        if (!cms) {
          log("âŒ No CMS object found in window scope", "error");
          return;
        }

        const configPath = "admin/config.yml";
        log(`ğŸŒ Fetching config from: ${window.location.origin}/${configPath}`);

        try {
          const res = await fetch(configPath);
          log(`ğŸ“¡ Response status â†’ ${res.status}`);
          if (!res.ok) throw new Error(`Config fetch failed: ${res.status}`);
          const text = await res.text();
          log("ğŸ§¾ YAML preview:\n" + text.slice(0, 250));

          if (!window.jsyaml) throw new Error("js-yaml not loaded");
          const config = window.jsyaml.load(text);
          log("âœ… YAML parsed successfully", "success");
          log("âœ… Parsed keys: " + Object.keys(config).join(", "));
          log(`âœ… Backend: ${config.backend.name}`, "success");

          // âœ… Initialize CMS
          cms.init({ config });
          log("ğŸ‰ CMS initialized successfully!", "success");
        } catch (err) {
          log("ğŸ”¥ CMS load error: " + err.message, "error");
        }
      });
    </script>
  </head>

  <body>
    <h3>ğŸ§© HaRiÃ© CMS Debug Console</h3>
    <div id="log">Loading...</div>

    <!-- CMS root container -->
    <div id="cms-root"></div>
  </body>
</html>
